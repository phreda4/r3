| r3/term/fire.r3| r3 optimizer| #seed #w2 $a3b195354a39b70d| :rand |  -- a:w4 w2 $DA942042E4DD58B5 * DUP 'w2 ! ;| :min | ab -- c:w31 OVER - DUP $3F >> AND + ;| :max | ab -- c:w32 OVER SWAP - DUP $3F >> AND - ;| :count | a -- bc:w6F $0 OVER ( @+ DUP $1 $38 /MOD DUP $3F / NAND SWAP NAND $8080808080808080 NAND? DROP SWAP $3 * SWAP ) $80 AND? ( 2DROP ; ) $8000 AND? ( 2DROP ; ) $800000 AND? ( 2DROP $1 * ; ) $80000000 AND? ( 2DROP DUP $1 * XOR ; ) $8000000000 AND? ( 2DROP $2 * ; ) $800000000000 AND? ( 2DROP DUP $2 * XOR ; ) $80000000000000 AND? ( 2DROP $6 + ; ) 2DROP DUP $3 * SWAP NAND ;| #mbuff #w7F * 65| :mbuffi |  -- a:w80 'w7F $6 * $0 OVER C! ;| :sign | ab -- c:w81 -? ( DROP $2D OVER C! ; ) DROP ;| :.d | a -- b:w82 DUP ABS -? ( 2DROP "-9223372036854775808" ; ) w80 SWAP ( DUP $199999999999999A -$41 SWAP OVER $1 << DUP $2 << + - $30 + PICK2 C! SWAP SWAP 1? ) DROP SWAP w81 ;| :.b | a -- b:w83 w80 SWAP ( DUP $1 AND $30 + PICK2 C! SWAP SWAP $1 >>> 1? ) DROP ;| :.h | a -- b:w84 w80 SWAP ( DUP $F AND $30 + $39 >? ( DUP $3 * SWAP NAND ) PICK2 C! SWAP SWAP $4 >>> 1? ) DROP ;| :.o | a -- b:w85 w80 SWAP ( DUP $7 AND $30 + PICK2 C! SWAP SWAP $3 >>> 1? ) DROP ;| :.f! | abc -- d:w86 ( DUP $199999999999999A -$41 SWAP OVER $1 << DUP $2 << + - $30 + PICK2 C! SWAP SWAP 1? ) DROP $2E OVER C! OVER ABS $10 >>> ( DUP $199999999999999A -$41 SWAP OVER $1 << DUP $2 << + - $30 + PICK2 C! SWAP SWAP 1? ) DROP SWAP w81 ;| :.f | a -- b:w87 w80 OVER ABS $FFFF AND $2710 -$29810 w86 ;| #sys-AllocConsole #w96| #sys-FreeConsole #w97| #sys-ExitProcess #w98| #sys-GetStdHandle #w99| #sys-SetStdHandle #w9A| #sys-ReadFile #w9B| #sys-WriteFile #w9C| #sys-GetConsoleMode #w9D| #sys-SetConsoleMode #w9E| #sys-SetConsoleTitle #w9F| #sys-PeekConsoleInput #wA0| #sys-PeekNamedPipe #wA1| #sys-ReadConsoleInput #wA2| #sys-WriteConsole #wA3| #sys-ReadConsole #wA4| #sys-WriteConsoleOutput #wA5| #sys-FlushConsoleInputBuffer #wA6| #sys-GetNumberOfConsoleInputEvents #wA7| #sys-Sleep #wA8| #sys-WaitForSingleObject #wA9| #sys-GetLastError #wAA| #sys-CreateFile #wAB| #sys-CreateDirectory #wAC| #sys-CloseHandle #wAD| #sys-FlushFileBuffers #wAE| #sys-DeleteFile #wAF| #sys-RemoveDirectory #wB0| #sys-MoveFile #wB1| #sys-SetFilePointer #wB2| #sys-SetEndOfFile #wB3| #sys-GetFileAttributes #wB4| #sys-GetFileAttributesEx #wB5| #sys-GetFileSize #wB6| #sys-FileTimeToSystemTime #wB7| #sys-SystemTimeToTzSpecificLocalTime #wB8| #sys-GetProcessHeap #wB9| #sys-HeapAlloc #wBA| #sys-HeapFree #wBB| #sys-HeapReAlloc #wBC| #sys-GetTickCount #wBD| #sys-GetLocalTime #wBE| #sys-FindFirstFile #wBF| #sys-FindNextFile #wC0| #sys-FindClose #wC1| #sys-CreateProcess #wC2| #sys-GetConsoleScreenBufferInfo #wC3| #sys-SetConsoleScreenBufferSize #wC4| #sys-SetConsoleWindowInfo #wC5| #sys-GetCommandLine #wC6| #sys-GetConsoleWindow #wC7| #s-SetConsoleOutputCP #wC8| #s-SetConsoleCP #wC9| #sys-SetDllDirectory #wCA| #sys-SetCurrentDirectory #wCB| #sys-GetCurrentDirectory #wCC| :: |  -- :w104 "KERNEL32.DLL" LOADLIB DUP "AllocConsole" GETPROC 'w96 ! DUP "FreeConsole" GETPROC 'w97 ! DUP "ExitProcess" GETPROC 'w98 ! DUP "GetStdHandle" GETPROC 'w99 ! DUP "SetStdHandle" GETPROC 'w9A ! DUP "ReadFile" GETPROC 'w9B ! DUP "WriteFile" GETPROC 'w9C ! DUP "GetConsoleMode" GETPROC 'w9D ! DUP "SetConsoleMode" GETPROC 'w9E ! DUP "SetConsoleTitleA" GETPROC 'w9F ! DUP "PeekConsoleInputA" GETPROC 'wA0 ! DUP "PeekNamedPipe" GETPROC 'wA1 ! DUP "ReadConsoleInputA" GETPROC 'wA2 ! DUP "WriteConsole" GETPROC 'wA3 ! DUP "ReadConsoleA" GETPROC 'wA4 ! DUP "WriteConsoleOutputA" GETPROC 'wA5 ! DUP "GetNumberOfConsoleInputEvents" GETPROC 'wA7 ! DUP "FlushConsoleInputBuffer" GETPROC 'wA6 ! DUP "Sleep" GETPROC 'wA8 ! DUP "WaitForSingleObject" GETPROC 'wA9 ! DUP "GetLastError" GETPROC 'wAA ! DUP "CreateFileA" GETPROC 'wAB ! DUP "CreateDirectoryA" GETPROC 'wAC ! DUP "CloseHandle" GETPROC 'wAD ! DUP "FlushFileBuffers" GETPROC 'wAE ! DUP "DeleteFileA" GETPROC 'wAF ! DUP "RemoveDirectoryA" GETPROC 'wB0 ! DUP "MoveFileA" GETPROC 'wB1 ! DUP "SetFilePointer" GETPROC 'wB2 ! DUP "SetEndOfFile" GETPROC 'wB3 ! DUP "GetFileAttributesA" GETPROC 'wB4 ! DUP "GetFileAttributesExA" GETPROC 'wB5 ! DUP "GetFileSize" GETPROC 'wB6 ! DUP "FileTimeToSystemTime" GETPROC 'wB7 ! DUP "SystemTimeToTzSpecificLocalTime" GETPROC 'wB8 ! DUP "GetProcessHeap" GETPROC 'wB9 ! DUP "HeapAlloc" GETPROC 'wBA ! DUP "HeapFree" GETPROC 'wBB ! DUP "HeapReAlloc" GETPROC 'wBC ! DUP "GetLocalTime" GETPROC 'wBE ! DUP "FindFirstFileA" GETPROC 'wBF ! DUP "FindNextFileA" GETPROC 'wC0 ! DUP "FindClose" GETPROC 'wC1 ! DUP "CreateProcessA" GETPROC 'wC2 ! DUP "GetTickCount" GETPROC 'wBD ! DUP "GetConsoleScreenBufferInfo" GETPROC 'wC3 ! DUP "GetCommandLineA" GETPROC 'wC6 ! DUP "SetConsoleScreenBufferSize" GETPROC 'wC4 ! DUP "SetConsoleWindowInfo" GETPROC 'wC5 ! DUP "GetConsoleWindow" GETPROC 'wC7 ! DUP "SetDllDirectoryA" GETPROC 'wCA ! DUP "SetCurrentDirectory" GETPROC 'wCB ! DUP "GetCurrentDirectory" GETPROC 'wCC ! DUP "SetConsoleOutputCP" GETPROC 'wC8 ! DUP "SetConsoleCP" GETPROC 'wC9 ! DROP ;| #here #w133 0| :,s | a -- :w138 w133 SWAP ( C@+ 1? ROT C!+ SWAP ) 2DROP 'w133 ! ;| :,word | a -- :w139 w133 SWAP ( C@+ $FF AND $20 >? ROT C!+ SWAP ) 2DROP 'w133 ! ;| :,line | a -- :w13A w133 SWAP ( C@+ 1? $A =? ( DUP $1 * XOR ) $D =? ( 2DROP 'w133 ! ; ) ROT C!+ SWAP ) 2DROP 'w133 ! ;| #memmap #w14A * 512| #memmap> #w14B 'w14A| :empty |  -- :w14D w14B 'w14A =? ( DROP MEM 'w133 ! ; ) $3 / DUP $3F / NAND DUP 'w14B ! @ 'w133 ! ;| :c0 |  -- :w155 ;| :c1 |  -- :w156 ;| :c2 | ab -- c:w157 SWAP w83 w138 ;| :c3 | ab -- c:w158 SWAP 0? ( DROP ; ) w138 ;| :c4 | ab -- c:w159 SWAP w82 w138 ;| :c5 |  -- :w15A $25 w133 C!+ 'w133 ! ;| :c6 | ab -- c:w15B SWAP w87 w138 ;| :c7 | ab -- c:w15C SWAP 0? ( DROP ; ) w139 ;| :c8 | ab -- c:w15D SWAP w84 w138 ;| :c9 | ab -- c:w15E SWAP $10 >> w82 w138 ;| :ca | ab -- c:w15F SWAP $FFFF AND w82 w138 ;| :cb | ab -- c:w160 SWAP w133 C!+ 'w133 ! ;| :cc | ab -- c:w161 SWAP 0? ( DROP ; ) w13A ;| :cd |  -- :w162 ;| :ce |  -- :w163 $D w133 C!+ 'w133 ! ;| :cf | ab -- c:w164 SWAP w85 w138 ;| #control #w165 'w155 'w156 'w157 'w158 'w159 'w15A 'w15B 'w15C 'w15D 'w15E 'w15F 'w160 'w161 'w162 'w163 'w164| :,emit | ab -- c:w166 $25 <>? ( w133 C!+ 'w133 ! ; ) DROP C@+ $F AND $3 << 'w165 + @ EX ;| #buff #w168 * 4096| :sprintc | a -- bc:w16B w133 w14B !+ 'w14B ! 'w168 'w133 ! ( C@+ 1? w166 ) 2DROP $0 w133 C!+ 'w133 ! w133 w14D 'w168 SWAP OVER - ;| #stdin #w189| #stdout #w18A| #stderr #w18B| #rows #w18D| #cols #w18E| #eventBuffer #w18F * 32| #ne #w190| #prevrc #w191 0| :getterminfo |  -- :w192 w18A 'w18F wC3 SYS2 DROP 'w18F $A + @ DUP $20 >> $FFFF AND OVER $FFFF AND - 'w18E ! DUP $30 >> $FFFF AND SWAP $10 >> $FFFF AND - 'w18D ! ;| #on-resize #w197 0| :sizecalc |  -- :w199 'w18F $2 * W@+ 'w18E ! W@ 'w18D ! ;| :sizeex |  -- :w19A w18D $10 << w18E OR w191 =? ( DROP ; ) 'w191 ! w197 0? ( DROP ; ) EX ;| :evtkey |  -- a:w19B 'w18F DUP $2 * C@ 0? ( NIP ; ) DROP $E + C@ $1B <>? ( ; ) $38 << ( $8 >> w189 'w190 wA7 SYS2 DROP w190 1? DROP w189 'w18F $1 'w190 wA2 SYS4 DROP 'w18F $E + C@ 1? $38 << OR ) DROP ( $FF NAND? $8 >> ) ;| :getEvent |  -- a:w19C w189 'w190 wA7 SYS2 DROP w190 0? ( ; ) DROP w189 'w18F $1 'w190 wA2 SYS4 DROP w18F $FFFF AND ;| #evtmx #w19D| #evtmy #w19E| #evtmb #w19F| #evtmw #w1A0| :evnmouse |  -- :w1A2 $0 'w1A0 ! 'w18F $4 * C@ $1 =? ( DROP 'w18F $2 * W@+ 'w19D ! W@ 'w19E ! ; ) $4 =? ( DROP 'w18F $3 * D@ $17 >> $1 OR 'w1A0 ! ; ) DROP 'w18F $3 * D@ 'w19F ! ;| :evtsize | a -- b:w1A3 ( $4 =? ( w199 ) w19C $2 >? DROP ) DROP w19A ;| :inevt |  -- a:w1A4 w19C $4 =? ( w1A3 ; ) $2 >? ( DROP w1A4 ; ) $2 =? ( w1A2 ) ;| :inkey |  -- a:w1A6 w1A4 $1 =? ( DROP w19B ; ) DROP $0 ;| :.free | a -- :w1A8 w189 $7 w9E SYS2 DROP w18A $3 w9E SYS2 DROP wA6 SYS1 DROP w97 SYS0 DROP ;| :.reterm |  -- :w1A9 w189 $298 w9E SYS2 DROP w18A $7 w9E SYS2 DROP ;| :: |  -- :w1AA w104 MEM 'w133 ! w96 SYS0 DROP -$A w99 SYS1 'w189 ! -$B w99 SYS1 'w18A ! -$C w99 SYS1 'w18B ! w189 $7 w9E SYS2 DROP w18A $3 w9E SYS2 DROP w192 w1A9 w18D $10 << w18E OR 'w191 ! $FDE9 wC8 SYS1 DROP $FDE9 wC9 SYS1 DROP ;| #outbuf #w1D0| #outbuf> #w1D1 'w1D0| #endbuf #w1D2| :.flush |  -- :w1D4 w1D1 w1D0 - 0? ( DROP ; ) w1D0 SWAP w18A -ROT $0 $0 w9C SYS5 DROP w1D0 'w1D1 ! ;| :.type | ab -- :w1D5 w1D2 w1D1 - >? ( w1D4 ) w1D1 ROT PICK2 CMOVE 'w1D1 +! ;| :.emit | a -- :w1D6 w1D1 w1D2 =? ( w1D4 w1D0 NIP ) C!+ 'w1D1 ! ;| :: |  -- :w22A w1AA w133 DUP 'w1D0 ! DUP 'w1D1 ! DUP $10 * SWAP NAND DUP 'w1D2 ! 'w133 ! ;| #buffer1 #w22B| #buffer2 #w22C| #bufsize #w22D| :firecolor | a -- b:w22E 0? ( ; ) $50 <? ( DROP $34 ; ) $78 <? ( DROP $58 ; ) $A0 <? ( DROP $7C ; ) $C8 <? ( DROP $E2 ; ) DROP $E7 ;| :getval | ab -- c:w22F $0 w32 w18D w31 SWAP $0 w32 w18E w31 SWAP w18E * + w22B + C@ $FF AND ;| :avgfire | ab -- c:w230 SWAP $3 w4 $1 >>> -$41 + SWAP w22F $10 w4 $1 >>> -$4 + $0 w32 ;| :updatefire |  -- :w231 w22C >A $0 ( w18D <? $0 ( w18E <? 2DUP SWAP w230 CA!+ ) DROP ) DROP w22B w22C 'w22B ! 'w22C ! ;| :drawfire |  -- :w232 w22B >A $0 ( w18D <? $1 OVER "%d;%dH" $1B w1D6 $5B w1D6 w16B w1D5 $0 ( w18E <? CA@+ $FF AND DUP w22E 1? ( DUP "38;5;%dm" $1B w1D6 $5B w1D6 w16B w1D5 ) DROP $5 >> $7 AND " .*#@&$X" + C@ w1D6 ) DROP ) DROP ;| :makeheat |  -- :w233 w22B w18D w18E * + >A w18E ( 1? $64 w4 $1 >>> -$26C0 CA!+ ) DROP ;| :main |  -- :w234 "H" $1B w1D6 $5B w1D6 w6F w1D5 w233 w231 w232 w1D4 w1A6 $1B =? ( DROP ; ) DROP $1E wA8 SYS1 DROP w234 ;| :reset |  -- :w235 w14D w133 w14B !+ 'w14B ! "0m" $1B w1D6 $5B w1D6 w6F w1D5 "H" $1B w1D6 $5B w1D6 w6F w1D5 "J" $1B w1D6 $5B w1D6 w6F w1D5 w18E w18D * DUP 'w22D ! w133 DUP 'w22B ! + 'w22C ! w22B $0 w22D CFILL w22C $0 w22D CFILL ;|-----BOOT-----: w22A "?25l" $1B w1D6 $5B w1D6 w6F w1D5 w133 w14B !+ 'w14B ! w235 'w235 'w197 ! w234 "0m" $1B w1D6 $5B w1D6 w6F w1D5 w1A8 ;