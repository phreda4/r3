| Utg Graphics
| PHREDA 2025
^r3/lib/term.r3

#f8x8 | xz font
$0 $100010003000200 $4100820 $4102EB81D740820 
$5D405DC0DD40080 $1014092814902808 $544246406400200 $1000080 
$60030003000090 $90000C000C00600 $11005D401900000 $4005D400C00000 
$240008000000000 $55400000000 $140028000000000 $400024000240000 
$550390C309C0AA0 $55400C004C00280 $15542550100C0AA0 $550200C10A40AA0 
$403AE809C00080 $550200C3AA02AA8 $550300C3AA00AA0 $100024000242AA8 
$550300C1AA40AA0 $550055C300C0AA0 $100000002000000 $900020001000000 
$10018000900000 $AA80AA80000 $100009001800000 $40004010240AA0 
$5503154326C0AA0 $1004355C300C0AA0 $1550300C3AA42AA0 $550300830040AA0 
$1540302430182A80 $155430003AA02AA8 $100030003AA02AA8 $550305C30040AA0 
$1004300C3AAC2008 $55400C000C00AA8 $550300C000C0008 $100430603A402020 
$1554300030002000 $1004300C369C2008 $1004306C360C2008 $550300C300C0AA0 
$10003550300C2AA0 $550318C300C0AA0 $10043570300C2AA0 $550200C1AA00AA0 
$10003000300AAA8 $550300C300C2008 $1401824300C2008 $410328C300C2008 
$1004096006902008 $100030018908008 $1554090000902AA8 $5400C000C000A8 
$10018018000000 $1500030003002A00 $100030027600200 $AAAA000000000000 
$15540C002E8402A0 $550257005600000 $5500C0C0EA00800 $1500C0009500000 
$55030300AB00020 $550354025600000 $1000300038000A0 $A901AB025700000 
$101030303A802000 $54003000A000200 $690003000200020 $4100D800E400800 
$50030003000200 $1110333036600000 $1010303035600000 $540303025600000 
$30003A9035600000 $381AB025700000 $4000C0009500000 $1540056025400000 
$50030007400200 $540303030300000 $1000CC030300000 $440333032300000 
$1010098018900000 $A901AB030300000 $1550090015D00000 $5400C00A4000A8 
$4000C000C00080 $1500030001A02A00 $4400220 $0 

#f8x8a | a font
$4007F43FFF0A28 $3C003D503EA03C0 $F000F000F000F $5540ABC003C0 
$3C057C0ABC003C0 $3C057C0AA800000 $F4002F4002F4002F $1F01F81F80F800 
$BFFF0BFF00BF000B $FF00FF00000000 $FFFEFFE0FE00E000 $FF00FF 
$FF00FF00 $FFFF $FFFF000000000000 $FF00FF0000000000 
$15015952B7A02A0 $3C003D502AA0000 $5555AAAA0000 $3C057D5ABEA03C0 
$5503FFC2FF80000 $FFFFFFFF00000000 $F000F000F000F000 $3C057D5AAAA0000 
$5555ABEA03C0 $FF00FF00FF00FF00 $15503EA03C0 $15417D43D403D40 
$14003C02FF80280 $1401FF403C00280 $7802FA80280 $2D02AF80280 
$0 $140014003C00280 $3C3C2828 $1414BEBE7D7D2828 
$1402AB41EA00BE8 $10142D2816D02828 $5453C7D0BD00B78 $3C00280 
$5403E003D000A8 $15000BC007C02A00 $2D78AFFA2828 $3C02BE80280 
$B40028000000000 $2AA80000 $140028000000000 $10002D0002D00028 
$5503D3C3CBC0AA0 $155403C007C00280 $15540B4014B40AA0 $550287802D02AA8 
$503EF80BF000A0 $550283C3EA02AA8 $5503C3C3EA00AA0 $5000B4000B42AA8 
$5503C3C1EB40AA0 $54000B41EBC0AA0 $140028003C00000 $B40028003C00000 
$1401E00B4000B4 $2AA815540000 $14000B4001E01E00 $140014014B40AA0 
$5543C543CBC0AA0 $14143EBC2D780280 $15503C3C3EB42AA0 $5503C283C140AA0 
$15403CB43C782A80 $15543C003EA02AA8 $14003C003EA02AA8 $5543C7C3C000AA8 
$14143C3C3EBC2828 $155403C003C02AA8 $550283C003C00A8 $14143DE03ED02828 
$15543C003C002800 $14053C4F3FBF280A $14143DFC3FBC2828 $5503C3C3C3C0AA0 
$14003D503C3C2AA0 $5143CB43C3C0AA0 $14143DF03C3C2AA0 $550003C1EA00AA0 
$14003C003C02AA8 $15543C3C3C3C2828 $1401EB43C3C2828 $14053F7F3C8F280A 
$14142D781EB42828 $14003C01EB42828 $15542D0002D02AA8 $15403C003C002A8 
$1401E01E002000 $154003C003C02A80 $14050B780080 $5555000000000000 
$1401FF42FF80280 $5542D7C05780000 $15503C3C3EA02800 $5503C002D500000 
$5543C3C0ABC0028 $5503D542D780000 $14003C00BE800A8 $2AB41EBC2D7C0000 
$14143C3C3EA02800 $55003C00A800280 $AB4003C00280028 $14143DE03CA02800 
$55003C003C00A80 $14053DDF3EBE0000 $14143C3C3D780000 $5503C3C2D780000 
$3C003EB43D780000 $3C1EBC2D7C0000 $14003C003D780000 $155005782D540000 
$5403C017D40280 $5543C3C3C3C0000 $1401EB43C3C0000 $5141FFD3C8F0000 
$14140BE01EB40000 $2AD01EBC3C3C0000 $15540B4015F40000 $55017D42FF80280 
$3C003C003C003C0 $143C7C3FE02AA8 $4007C02FC002C0 $10003D003F80380 

|--- 3bytes utf-8 align to 4
#tx " " ( 0 0 ) "▀" "▄" "█"	 | 3bytes utf-char
:bc 2 << 'tx + .write ;
	
:bigline | val -- val
	16 ( 1? 2 - 2dup >> $3 and bc ) drop ;
	
:]nl "B" .[w "8D" .[w ; | dn8*le;
:]nc "3A" .[w "D" .[w ; | 4upri;
	
:bigemit | ascii --
	$7f and 32 - clamp0 
	3 << 'f8x8 + @
	bigline 16 >> ]nl 
	bigline 16 >> ]nl
	bigline 16 >> ]nl
	bigline drop ]nc ;

:bigemita | ascii --
	$7f and 3 << 'f8x8a + @
	bigline 16 >> ]nl 
	bigline 16 >> ]nl
	bigline 16 >> ]nl
	bigline drop ]nc ;

:xcol
	$20 nand 63 >? ( 7 - ) $30 - $f and ;
:escape
	xcol .bc c@+ xcol .fc ;
:xchar | char
	$5b =? ( drop c@+ $5b <>? ( escape ; ) ) | [[
	bigemit ;
	
| big font zx, colors with [BF 
::.xwrite | str --
	( c@+ 1? xchar ) 2drop ;

:achar | char
	$5b =? ( drop c@+ $5b <>? ( escape ; ) ) | [[
	bigemita ;

| big font A, colors with [BF 
::.awrite | str --
	( c@+ 1? achar ) 2drop ;

|---- Draw lines
#vl ( $e2 $94 $82 $1b $5b $42 $1b $5b $44 0 ) | |v<
#vd	( $e2 $95 $91 $1b $5b $42 $1b $5b $44 0 ) | ||v<

::.vline | h --
	'vl .rep ;
::.hline | w --
	"─" .rep ;
	
::.vlined | h --
	'vd .rep ;
::.hlined | w --
	"═" .rep ;

::.boxl | x y w h --
	3 <? ( 4drop ; ) swap
	3 <? ( 4drop ; ) swap
	2over .at
	"┌" .write over 2 - "─" .rep "┐" .write
	2swap 1+
	2swap 2 -
	( 1? 1- >r
		pick2 pick2 .at "│" .write 
		pick2 over + 1- .col "│" .write 
		swap 1+ swap r> ) drop 	
	-rot .at
	"└" .write 2 - "─" .rep "┘" .write ;

::.boxc | x y w h --
	3 <? ( 4drop ; ) swap
	3 <? ( 4drop ; ) swap
	2over .at
	"╭" .write over 2 - "─" .rep "╮" .write
	2swap 1+
	2swap 2 -
	( 1? 1- >r
		pick2 pick2 .at "│" .write 
		pick2 over + 1- .col "│" .write 
		swap 1+ swap r> ) drop 	
	-rot .at
	"╰" .write 2 - "─" .rep "╯" .write ;

::.boxd | x y w h --
	3 <? ( 4drop ; ) swap
	3 <? ( 4drop ; ) swap
	2over .at
	"╔" .write over 2 - "═" .rep "╗" .write
	2swap 1+
	2swap 2 -
	( 1? 1- >r
		pick2 pick2 .at "║" .write 
		pick2 over + 1- .col "║" .write 
		swap 1+ swap r> ) drop 
	-rot .at
	"╚" .write 2 - "═" .rep "╝" .write ;
	
::.boxf
	1 <? ( 4drop ; ) swap
	1 <? ( 4drop ; ) swap
	( 1? 1- >r
		pick2 pick2 .at
		dup .nsp swap 1+ swap 
		r> ) 4drop ;
	
|--- utf align | result in HERE
::lalign | cnt str -- 
	mark
	utf8count	| cnt str scount
	pick2 >? ( drop over ) 
	swap		| cnt scnt str
	here pick2 utf8ncpy 'here !
	- ,nsp 
	,eol empty ;
	
::calign | cnt str --
	mark
	utf8count	| cnt str scount
	pick2 >? ( drop over )	| cnt str scount
	rot over -				| str scount resto
	-rot 					| resto str scount
	pick2 1+ 2/				| resto str scount ini
	,nsp
	swap here rot utf8ncpy 'here ! | resto
	2/ ,nsp 
	,eol empty ;

::ralign | cnt str --
	mark
	utf8count	| cnt str scount
	pick2 >? ( drop over ) 
	rot over - | str scount resto
	,nsp
	here swap utf8ncpy 'here ! 
	,eol empty ;	
	
|---- format
	
::lwrite | w "str" --
	lalign here .write ;
::cwrite | w "str" --
	calign here .write ;
::rwrite | w "str" --
	ralign here .write ;

|---- Text
#strsplit
#strsplit>
#lines
#cntlines

:emit0
	13 =? ( drop dup c@ 10 =? ( swap 1+ swap ) drop 0 ; )
	10 =? ( drop dup c@ 13 =? ( swap 1+ swap ) drop 0 ; )
	$3b =? ( 0 nip ) ;
	
:<<sp | stro str -- str'
	swap over
	( over <? ( 2drop ; ) 
		dup c@ $ff and 32 >? 
		drop 1- ) drop nip nip ;

:testw | str -- str
	pick4 >r utf8count 
	r> swap >? ( drop ; ) | str count
	over a!+ | newline
	utf8bytes | str bytes
	over + <<sp
	0 swap c!+
	testw ;
	
:splitlines | str --
	here dup >a 'strsplit ! 
	( c@+ 1? emit0 ca!+ ) nip | put 0 in ; or cr
	a> 'strsplit> !
	ca!+ 
	a> 'lines !
	strsplit ( strsplit> <?
		testw dup a!+ >>0
		) drop
	0 a!+
	a> dup 'here ! 
	lines - 3 >> 'cntlines !
	;	

:vtop	drop ;
:vcen	cntlines - 2/ + ;
:vbot	cntlines - ;

#halign 'calign
#valign 'vcen

::xalign | $VH --
	dup $3 and
	0 =? ( 'lalign 'halign !  )
	1 =? ( 'calign 'halign ! )
	2 =? ( 'ralign 'halign ! )
	drop
	4 >> $3 and
	0 =? ( 'vtop 'valign ! )
	1 =? ( 'vcen 'valign ! )
	2 =? ( 'vbot 'valign ! )
	drop ;

::xwrite | w "str" --
	halign ex here .write ;
	
::xText | w h x y "" --
	mark ab[ 
	splitlines 
	rot 	| w x y h
	valign ex
	lines >a ( 
		2dup .at
		a@+ 1? pick3 swap xwrite 
		1+
		) drop
	3drop
	]ba empty ;
